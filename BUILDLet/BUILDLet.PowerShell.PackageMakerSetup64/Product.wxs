<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <!-- Include -->
  <?include ..\Version\InstallerInfo.wxi?>
  <?include ..\Version\InstallerGUID.wxi?>

  <!-- Product Information -->
  <?define ProductName="$(var.PSPackageMaker_ProductName)"?>
  <?define ProductComment="$(var.PSPackageMaker_ProductComment)"?>
  <?define PSModuleName="$(var.PSPackageMaker_PSModuleName)"?>

  <!-- GUID -->
  <?define GUID_Product="$(var.GUID_PSPackageMaker64_Product)"?>
  <?define GUID_UpgradeCode="$(var.GUID_PSPackageMaker64_UpgradeCode)"?>
  <?define GUID_ProductComponent="$(var.GUID_PSPackageMaker64_ProductComponent)"?>


  <!-- Source Files -->
  <?define Source_ProductComponent_PSD1="..\Release\BUILDLet.PowerShell.PackageMaker\BUILDLet.PowerShell.PackageMaker.psd1"?>
  <?define Source_ProductComponent_PSM1="..\Release\BUILDLet.PowerShell.PackageMaker\BUILDLet.PowerShell.PackageMaker.psm1"?>
  <!-- (There is no DLL) -->


  <!-- Product -->
  <Product Id="$(var.GUID_Product)"
           UpgradeCode="$(var.GUID_UpgradeCode)"
           Manufacturer="$(var.Manufacturer)"
           Name="$(var.ProductName) (x64) $(var.Version)"
           Version="$(var.Version)"
           Language="1041" Codepage="932">

    <Package Id="*"
             Platform="x64"
             Description="$(var.ProductName) (x64) $(var.Version) Installer"
             Comments="$(var.ProductComment) (x64)"
             Manufacturer="$(var.Manufacturer)"
             InstallerVersion="200"
             Compressed="yes"
             Languages="1041" SummaryCodepage="932"
             InstallScope="perMachine" />


    <!-- Install Condition -->
    <Condition Message="This program is available only for x64 platform.">VersionNT64</Condition>
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />


    <!-- Media -->
    <MediaTemplate CabinetTemplate="data{0}.cab" EmbedCab="yes" />


    <!-- Feature (x64) -->
    <Feature Id="ProductFeature64" Title="$(var.ProductName) (x64)"  Level="1">
      <ComponentGroupRef Id="ProductComponents64" />
    </Feature>

  </Product>



  <!-- Directories -->
  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">

      <!-- PSModulePath (x64) -->
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="WindowsPowerShell64Folder" Name="WindowsPowerShell">
          <Directory Id="PSModule64Folder" Name="Modules">
            <Directory Id="INSTALLFOLDER64" Name="$(var.PSModuleName)" />
          </Directory>
        </Directory>
      </Directory>

    </Directory>
  </Fragment>



  <!-- Components -->
  <Fragment>

    <!-- Program Files (x64) -->
    <ComponentGroup Id="ProductComponents64" Directory="INSTALLFOLDER64">
      <Component Id="ProductComponent64" Guid="$(var.GUID_ProductComponent)" Win64="yes">
        <File Source="$(var.Source_ProductComponent_PSD1)" />
        <File Source="$(var.Source_ProductComponent_PSM1)" />
        <!-- (There is no DLL) -->

        <!-- Registry registration is removed. -->
        <!--
        <RegistryValue Root="HKLM" Key='SOFTWARE\[Manufacturer]\[ProductName]' Name='installed' Type='integer' Value='1' KeyPath='yes' />
        -->
      </Component>
    </ComponentGroup>

  </Fragment>
</Wix>
